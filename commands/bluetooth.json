{
  "checks": [
    {
      "category": "BLUETOOTH",
      "label": "Bluetooth Enabled",
      "command": "settings get global bluetooth_on",
      "safe_pattern": "^0$",
      "level": "warning",
      "description": "NIST recommends disabling Bluetooth when not in use (SC-8)"
    },
    {
      "category": "BLUETOOTH",
      "label": "Discoverable Mode",
      "command": "settings get global bluetooth_discoverability",
      "safe_pattern": "^0$",
      "level": "critical",
      "description": "Device should not be discoverable (AC-18)"
    },
    {
      "category": "BLUETOOTH",
      "label": "Secure Pairing Mode",
      "command": "dumpsys bluetooth_manager | grep 'Pairing mode:'",
      "safe_pattern": "Pairing mode:.*Secure",
      "level": "warning",
      "description": "Only secure pairing modes should be allowed (NIST IA-2)"
    },
    {
      "category": "BLUETOOTH",
      "label": "Bluetooth Encryption",
      "command": "dumpsys bluetooth_manager | grep 'Encryption:'",
      "safe_pattern": "Encryption:.*Enabled",
      "level": "warning",
      "description": "Bluetooth encryption must be enabled (SC-13)"
    },
    {
      "category": "BLUETOOTH",
      "label": "Authentication Required",
      "command": "dumpsys bluetooth_manager | grep 'Authentication:'",
      "safe_pattern": "Authentication:.*Required",
      "level": "warning",
      "description": "Authentication must be required for pairing (IA-2)"
    },
    {
      "category": "BLUETOOTH",
      "label": "MAC Randomization",
      "command": "settings get secure bluetooth_address | grep -E '([0-9A-F]{2}:){5}[0-9A-F]{2}'",
      "safe_pattern": "^$",
      "level": "warning",
      "description": "Static MAC addresses should be avoided (SC-8(1))"
    },
    {
      "category": "BLUETOOTH",
      "label": "Paired Devices Count",
      "command": "dumpsys bluetooth_manager | grep 'Bonded devices:' -A 10 | grep 'Device:' | wc -l",
      "safe_pattern": "^0$",
      "level": "warning",
      "description": "Review all paired devices (AC-3)"
    },
    {
      "category": "BLUETOOTH",
      "label": "HCI Snoop Logging",
      "command": "settings get secure bluetooth_hci_log",
      "safe_pattern": "^0$",
      "level": "info",
      "description": "HCI logging should be disabled in production (AU-12)"
    },
    {
      "category": "BLUETOOTH",
      "label": "Unnecessary Profiles",
      "command": "dumpsys bluetooth_manager | grep 'Profile:' | grep -vE 'A2DP|HFP|HSP'",
      "safe_pattern": "^$",
      "level": "warning",
      "description": "Disable unused profiles (CM-7)"
    },
    {
      "category": "BLUETOOTH",
      "label": "LE Security Mode",
      "command": "dumpsys bluetooth_manager | grep 'LE Security Mode:'",
      "safe_pattern": "LE Security Mode: [2-4]",
      "level": "warning",
      "description": "LE should use Mode 2 (Secure Connections) or higher (SC-13)"
    },
    {
      "category": "BLUETOOTH",
      "label": "Bluetooth Version",
      "command": "getprop ro.bluetooth.version",
      "safe_pattern": "^[5-9]|[1-9][0-9]",
      "level": "info",
      "description": "Bluetooth version should be 5.0 or newer for enhanced features"
    },
    {
      "category": "BLUETOOTH",
      "label": "Just Works Pairing",
      "command": "dumpsys bluetooth_manager | grep -i 'Just Works'",
      "safe_pattern": "^$",
      "level": "warning",
      "description": "Just Works insecure pairing method should not be enabled (IA-2)"
    },
    {
      "category": "BLUETOOTH",
      "label": "Link Key Strength",
      "command": "dumpsys bluetooth_manager | grep -i 'Key Length'",
      "safe_pattern": "128",
      "level": "warning",
      "description": "Link encryption key length must be at least 128 bits (IA-5)"
    },
    {
      "category": "BLUETOOTH",
      "label": "Bluetooth Debugging Interface",
      "command": "dumpsys bluetooth_manager | grep -i 'Debug.*true'",
      "safe_pattern": "^$",
      "level": "warning",
      "description": "Bluetooth debugging interfaces must be disabled in production (CM-6)"
    },
    {
      "category": "BLUETOOTH",
      "label": "Secure Simple Pairing (SSP)",
      "command": "dumpsys bluetooth_manager 2>/dev/null | grep -iq 'Secure Simple Pairing.*Enabled' && echo Enabled || echo Disabled",
      "safe_pattern": "Enabled",
      "level": "warning",
      "description": "Checks if SSP is enabled (downgrade attacks like KNOB are prevented)."
    },
    {
      "category": "BLUETOOTH",
      "label": "Bluedroid Stack Active",
      "command": "[ $(getprop ro.bluetooth.stack 2>/dev/null | grep -i bluedroid | wc -l) -gt 0 ] && echo VULNERABLE || echo SAFE",
      "safe_pattern": "SAFE",
      "level": "warning",
      "description": "Detects if Bluedroid stack is active (BlueBorne vulnerable; upgrade to Fluoride recommended)."
    },
    {
      "category": "BLUETOOTH",
      "label": "Bluetooth Firmware Files",
      "command": "ls /vendor/firmware/bluetooth* /system/etc/firmware/bluetooth* 2>/dev/null | wc -l",
      "safe_pattern": "^[1-9][0-9]*$",
      "level": "warning",
      "description": "Checks for signed Bluetooth firmware blobs (missing may mean tampering or custom build)."
    },
    {
      "category": "BLUETOOTH",
      "label": "Raw Radio Device Nodes",
      "command": "ls /dev/radio* /dev/hci* 2>/dev/null | wc -l",
      "safe_pattern": "^0$",
      "level": "warning",
      "description": "Exposes low-level radio nodes. Presence may indicate increased attack surface."
    },
    {
      "category": "BLUETOOTH",
      "label": "bluetoothd Hardening",
      "command": "(ps -A -o cmd 2>/dev/null | grep -E 'bluetoothd|bluetooth' | grep -q -- -n) && echo HARDENED || echo UNPROTECTED",
      "safe_pattern": "HARDENED",
      "level": "warning",
      "description": "Checks if the Bluetooth daemon runs in hardened (no-privilege) mode."
    },
    {
      "category": "BLUETOOTH",
      "label": "BR/EDR Secure Connections",
      "command": "settings get global bluetooth_br_edr_secure_connections 2>/dev/null | grep -q '^1$' && echo Enforced || echo NotEnforced",
      "safe_pattern": "Enforced",
      "level": "critical",
      "description": "Should return 'Enforced' to guarantee strong encryption (prevents KNOB attack)."
    },
    {
      "category": "BLUETOOTH",
      "label": "SELinux Bluetooth Policy",
      "command": "(ls -Z /system/bin/bluetooth* 2>/dev/null | grep -q 'bluetooth:s0') && echo RESTRICTIVE || echo PERMISSIVE",
      "safe_pattern": "RESTRICTIVE",
      "level": "warning",
      "description": "SELinux domain for Bluetooth should be restrictive to prevent privilege escalation."
    },
    {
      "category": "BLUETOOTH",
      "label": "BLE MAC Randomization",
      "command": "VAR=$(settings get global bluetooth_address_rotation_enabled 2>/dev/null); if [ -z \"$VAR\" ]; then echo NotSupported; elif [ \"$VAR\" = \"1\" ]; then echo Enabled; else echo Disabled; fi",
      "safe_pattern": "Enabled",
      "level": "info",
      "description": "Should be enabled to randomize BLE MAC (prevents device tracking/leakage)."
    },
    {
      "category": "BLUETOOTH",
      "label": "Legacy Bluetooth Profiles",
      "command": "dumpsys bluetooth_manager | grep -E 'OBEX|PAN|SAP'",
      "safe_pattern": "^$",
      "level": "warning",
      "description": "Legacy profiles can expose device to known CVEs\u2014disable if not needed."
    },
    {
      "category": "BLUETOOTH",
      "label": "Custom Vendor Bluetooth Binaries",
      "command": "ls /vendor/lib*/hw/bluetooth* /system/lib*/hw/bluetooth* 2>/dev/null | wc -l",
      "safe_pattern": "^[1-9][0-9]*$",
      "level": "info",
      "description": "Lists vendor or custom Bluetooth libraries (review for supply chain risk)."
    },
    {
      "category": "BLUETOOTH",
      "label": "Bluetooth Stack Version",
      "command": "dumpsys package com.android.bluetooth | grep versionName",
      "safe_pattern": ".*",
      "level": "info",
      "description": "Review the version of the Bluetooth stack package."
    },
    {
      "category": "BLUETOOTH",
      "label": "Bluetooth Service Crashes",
      "command": "logcat -d -b crash | grep -i bluetooth | tail -n 5",
      "safe_pattern": "^$",
      "level": "info",
      "description": "Recent crashes in Bluetooth stack may indicate exploits or instability."
    },
    {
      "category": "BLUETOOTH",
      "label": "Scan Always Available",
      "command": "settings get global ble_scan_always_enabled",
      "safe_pattern": "^0$",
      "level": "warning",
      "description": "Should be disabled to prevent background BLE scanning (privacy risk)."
    },
    {
      "category": "BLUETOOTH",
      "label": "Apps with BLUETOOTH Permission",
      "command": "pm list permissions -g -d | grep -A1 'BLUETOOTH$' | grep -c 'package:'",
      "safe_pattern": "^[1-3]$",
      "level": "warning",
      "description": "Too many apps with BLUETOOTH permission increases risk."
    },
    {
      "category": "BLUETOOTH",
      "label": "Bluetooth Debug Properties",
      "command": "getprop | grep -i bluetooth | grep -i debug",
      "safe_pattern": "^$",
      "level": "info",
      "description": "Debug properties for Bluetooth should not be set on production."
    }
  ]
}