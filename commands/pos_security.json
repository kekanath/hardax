{
  "checks": [
    {
      "category": "POS_SECURITY",
      "label": "TEE Implementation",
      "command": "getprop ro.hardware.gatekeeper 2>/dev/null",
      "safe_pattern": ".+",
      "level": "warning",
      "description": "Trusted Execution Environment should be present for secure key operations"
    },
    {
      "category": "POS_SECURITY",
      "label": "Secure Element HAL",
      "command": "ls /vendor/lib64/hw/android.hardware.secure_element*.so /vendor/lib/hw/android.hardware.secure_element*.so 2>/dev/null | wc -l",
      "safe_pattern": "^[1-9][0-9]*$",
      "level": "info",
      "description": "Secure Element HAL libraries for hardware security module access"
    },
    {
      "category": "POS_SECURITY",
      "label": "Keymaster HAL Version",
      "command": "ls /vendor/lib64/hw/android.hardware.keymaster*.so /vendor/lib/hw/android.hardware.keymaster*.so 2>/dev/null | head -1 | grep -oE 'keymaster[@-]?[0-9.]+' || echo 'not_found'",
      "safe_pattern": ".+",
      "level": "info",
      "description": "Keymaster HAL version - higher versions have better security features"
    },
    {
      "category": "POS_SECURITY",
      "label": "Screen Lock Enabled",
      "command": "settings get secure lockscreen.disabled 2>/dev/null",
      "safe_pattern": "^(0|null)$",
      "level": "critical",
      "description": "PCI-DSS 8.1: Screen lock required for POS device access control"
    },
    {
      "category": "POS_SECURITY",
      "label": "Kiosk Mode (Lock Task)",
      "command": "dumpsys activity 2>/dev/null | grep -i 'mLockTaskModeState' | grep -oE '[0-9]+' || echo '0'",
      "safe_pattern": "^[1-2]$",
      "level": "warning",
      "description": "POS should run in kiosk/lock task mode to prevent unauthorized app access"
    },
    {
      "category": "POS_SECURITY",
      "label": "App Pinning Enabled",
      "command": "settings get secure lock_to_app_enabled 2>/dev/null",
      "safe_pattern": "^1$",
      "level": "warning",
      "description": "App pinning should be enabled for single-app POS kiosk mode"
    },
    {
      "category": "POS_SECURITY",
      "label": "Payment Apps Installed",
      "command": "pm list packages 2>/dev/null | grep -iE 'pay|wallet|pos|terminal|merchant|square|clover|toast|stripe|verifone|ingenico|pax' | wc -l",
      "safe_pattern": ".+",
      "level": "info",
      "description": "Count of payment-related applications installed"
    },
    {
      "category": "POS_SECURITY",
      "label": "Payment App Permissions",
      "command": "for pkg in $(pm list packages 2>/dev/null | grep -iE 'pay|wallet|pos|terminal' | cut -d: -f2 | head -3); do dumpsys package $pkg 2>/dev/null | grep -E 'permission.*INTERNET|permission.*NFC|permission.*CAMERA' | head -5; done",
      "safe_pattern": ".+",
      "level": "info",
      "description": "Review critical permissions granted to payment apps"
    },
    {
      "category": "POS_SECURITY",
      "label": "Dangerous Permission - CAMERA",
      "command": "pm list packages -p 2>/dev/null | while read pkg; do dumpsys package $(echo $pkg | cut -d: -f2) 2>/dev/null | grep -q 'android.permission.CAMERA.*granted=true' && echo $pkg; done | grep -ivE 'camera|photo|scan|barcode' | head -5",
      "safe_pattern": "^$",
      "level": "warning",
      "description": "Non-camera apps with CAMERA permission - potential card skimming risk",
      "empty_is_safe": true
    },
    {
      "category": "POS_SECURITY",
      "label": "Open Listening Ports",
      "command": "netstat -tlnp 2>/dev/null | grep -E 'LISTEN' | awk '{print $4}' | grep -oE '[0-9]+$' | sort -u | tr '\\n' ',' | sed 's/,$//'",
      "safe_pattern": ".+",
      "level": "info",
      "description": "PCI-DSS 1.1.6: Review all listening ports on POS terminal"
    },
    {
      "category": "POS_SECURITY",
      "label": "Remote Desktop Ports",
      "command": "netstat -tlnp 2>/dev/null | grep -E ':3389|:5900|:5901|:5800|:22' | grep 'LISTEN'",
      "safe_pattern": "^$",
      "level": "critical",
      "description": "PCI-DSS 2.2.7: RDP/VNC/SSH ports must be closed on POS terminals",
      "empty_is_safe": true
    },
    {
      "category": "POS_SECURITY",
      "label": "Suspicious Processes - Memory Tools",
      "command": "ps -A -o cmd 2>/dev/null | grep -iE 'memdump|memscrap|dump|tcpdump|strace|ltrace' | grep -v grep",
      "safe_pattern": "^$",
      "level": "critical",
      "description": "Memory dumping tools detected - potential RAM scraping malware indicator",
      "empty_is_safe": true
    },
    {
      "category": "POS_SECURITY",
      "label": "Suspicious Processes - Known POS Malware",
      "command": "ps -A -o cmd 2>/dev/null | grep -iE 'rdasrv|blackpos|alina|vskimmer|dexter|treasurehunt|fastpos|rawpos|posei|backoff|jackpos|punkey|multigrain|centerpos|malumpos' | grep -v grep",
      "safe_pattern": "^$",
      "level": "critical",
      "description": "Known POS malware process names detected",
      "empty_is_safe": true
    },
    {
      "category": "POS_SECURITY",
      "label": "Hotspot Disabled",
      "command": "settings get global wifi_ap_enabled 2>/dev/null",
      "safe_pattern": "^(0|null)$",
      "level": "critical",
      "description": "PCI-DSS: WiFi hotspot must be disabled on POS terminals"
    },
    {
      "category": "POS_SECURITY",
      "label": "Clipboard Manager Apps",
      "command": "pm list packages 2>/dev/null | grep -iE 'clipboard|clipper|copy|paste' | grep -v 'com.android'",
      "safe_pattern": "^$",
      "level": "warning",
      "description": "Third-party clipboard apps may capture card data",
      "empty_is_safe": true
    },
    {
      "category": "POS_SECURITY",
      "label": "Screen Capture Disabled",
      "command": "settings get secure screencapture_disabled 2>/dev/null",
      "safe_pattern": "^1$",
      "level": "warning",
      "description": "Screen capture should be disabled to protect card data display"
    },
    {
      "category": "POS_SECURITY",
      "label": "POS Vendor Properties",
      "command": "getprop 2>/dev/null | grep -iE 'pax|verifone|ingenico|newland|sunmi|elo|clover|square|toast' | head -10",
      "safe_pattern": ".+",
      "level": "info",
      "description": "POS vendor-specific system properties detected"
    },
    {
      "category": "POS_SECURITY",
      "label": "Log Files with Card Patterns",
      "command": "find /data/local /sdcard -name '*.log' -o -name '*.txt' 2>/dev/null | xargs grep -l -E '[0-9]{13,16}' 2>/dev/null | head -3",
      "safe_pattern": "^$",
      "level": "critical",
      "description": "PCI-DSS 3.4: Files potentially containing unencrypted card numbers",
      "empty_is_safe": true
    },
    {
      "category": "POS_SECURITY",
      "label": "Debug Log Level",
      "command": "getprop persist.log.tag 2>/dev/null",
      "safe_pattern": "^$",
      "level": "info",
      "description": "Verbose logging may expose sensitive payment data in logs",
      "empty_is_safe": true
    },
    {
      "category": "POS_SECURITY",
      "label": "Logcat Buffer Size",
      "command": "getprop persist.logd.size 2>/dev/null | grep -E '^[0-9]+[KMG]?$' || echo 'default'",
      "safe_pattern": ".+",
      "level": "info",
      "description": "Large log buffers may retain sensitive transaction data longer"
    },
    {
      "category": "POS_SECURITY",
      "label": "Certificate Pinning Bypass Apps",
      "command": "pm list packages 2>/dev/null | grep -iE 'sslunpin|trustme|justtrustme|httptoolkit'",
      "safe_pattern": "^$",
      "level": "critical",
      "description": "SSL pinning bypass tools detected - MITM attack possible",
      "empty_is_safe": true
    }
  ]
}